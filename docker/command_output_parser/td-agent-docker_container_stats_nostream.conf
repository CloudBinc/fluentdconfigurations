
<source>
  @type exec
  command docker container stats --no-stream
  format none
  tag docker
  run_interval 10s
</source>

<filter docker>
   @type concat
   key message
   multiline_start_regexp /^(CONTAINER)\s+(CPU\s\%)\s+(MEM\sUSAGE\s\/\sLIMIT)\s+(MEM\s\%)\s+(NET\sI\/O)\s+(BLOCK\s\I\/O)\s+(PIDS)/
   continuous_line_regexp /^(?!CONTAINER)[aA-zZ0-9.-/]+.*/
</filter>

<filter docker>
@type record_transformer
enable_ruby
  <record>
    data7 ${record["message"]}
    host "#{Socket.gethostname}"
    datatype7 "docker"
  </record>
</filter>

<filter docker>
@type record_transformer
enable_ruby
  <record>
   time7 ${Time.now.to_i}
  </record>
remove_keys message
</filter>

#File Output
<match docker>
@type file
@id docker_file
path /var/log/td-agent/parseddocker
</match>

